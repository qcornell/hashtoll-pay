<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HashToll Pay - Hedera Payment Links</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Inter font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    * { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }

    /* Your custom background image */
    body {
      min-height: 100vh;
      background-image: url('home_bg.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      overflow-x: hidden;
    }

    /* === NEON BORDER FRAME (border-only, no fill) === */
    .neon-frame {
      position: relative;
      border-radius: 30px;
      padding: 2px;
      overflow: visible;
    }

    /* the actual neon border ring */
    .neon-frame::before {
      content:"";
      position:absolute;
      inset:0;
      border-radius: inherit;
      padding: 2px;
      background: linear-gradient(135deg,
        rgba(59,130,246,0.95) 0%,
        rgba(168,85,247,0.85) 55%,
        rgba(236,72,153,0.60) 100%
      );

      /* mask so ONLY the border shows */
      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;

      pointer-events:none;
      z-index: 0;
    }

    /* outer glow bloom */
    .neon-frame::after {
      content:"";
      position:absolute;
      inset:-16px;
      border-radius: 44px;
      background: linear-gradient(135deg,
        rgba(59,130,246,0.70),
        rgba(168,85,247,0.60),
        rgba(236,72,153,0.50)
      );
      filter: blur(18px);
      opacity: 0.90;
      z-index: -1;
      pointer-events:none;
    }

    /* === SOFTER BLUR FOR BALANCED GLASS (More See-Through) === */
    .glass-card {
      position: relative;
      border-radius: 28px;

      /* Even more transparent base */
      background: rgba(22, 18, 45, 0.10);

      /* Milder blur for frost without haze */
      backdrop-filter: blur(24px) saturate(170%) contrast(1.02);
      -webkit-backdrop-filter: blur(24px) saturate(170%) contrast(1.02);

      /* NO big drop shadow */
      box-shadow: none;

      overflow: hidden;
      z-index: 1;
    }

    /* SUBTLER SPARKLE HIGHLIGHTS */
    .glass-card::before {
      content:"";
      position:absolute;
      inset:0;
      border-radius: inherit;

      background:
        radial-gradient(900px 260px at 20% 0%,
          rgba(255,255,255,0.18),
          rgba(255,255,255,0.04) 35%,
          rgba(255,255,255,0.00) 62%),
        radial-gradient(900px 340px at 100% 70%,
          rgba(168,85,247,0.08),
          rgba(168,85,247,0.00) 65%),
        radial-gradient(rgba(255,255,255,0.08) 1px, transparent 1px);

      background-size: 100% 100%, 100% 100%, 46px 46px;
      opacity: 0.45;
      mix-blend-mode: overlay;
      pointer-events:none;
      z-index: 1;
    }

    /* ENHANCED CRISP RIM (Premium Depth) */
    .glass-card::after {
      content:"";
      position:absolute;
      inset:0;
      border-radius: inherit;

      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.26),  /* Brighter inner line */
        inset 0 20px 30px rgba(255,255,255,0.10), /* Enhanced top shine */
        inset 0 -20px 30px rgba(0,0,0,0.16);     /* Softer bottom depth */

      pointer-events:none;
      z-index: 2;
    }

    /* keep real content above the overlays */
    .glass-card > * { position: relative; z-index: 3; }

    /* LIGHTER TRANSPARENT INPUTS */
    .field {
      background: rgba(10, 12, 30, 0.14);
      border: 1px solid rgba(255,255,255,0.12);
      color: rgba(255,255,255,0.95);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.03);
    }
    .field:focus {
      outline:none;
      border-color: rgba(99,102,241,0.60);
      box-shadow: 0 0 0 4px rgba(99,102,241,0.22);
    }

    /* Primary button */
    .btn-primary {
      background: linear-gradient(135deg, rgba(59,130,246,0.95), rgba(99,102,241,0.90));
      box-shadow:
        0 18px 45px rgba(59,130,246,0.25),
        0 0 0 1px rgba(255,255,255,0.08) inset;
    }
    .btn-primary:hover:not(:disabled) { 
      filter: brightness(1.06); 
      transform: translateY(-1px);
    }
    .btn-primary:active:not(:disabled) { transform: translateY(0); }

    /* GHOST BUTTON WITH PURPLE HINT */
    .btn-ghost {
      background: rgba(168,85,247,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 0 0 1px rgba(255,255,255,0.02) inset;
      color: rgba(255,255,255,0.80);
    }
    .btn-ghost:hover:not(:disabled) {
      background: rgba(168,85,247,0.08);
    }
    .btn-ghost:disabled {
      opacity: 0.40;
      cursor: not-allowed;
    }

    /* QR Code styling */
    .qr-wrapper canvas {
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
    }
  </style>
</head>

<body class="text-white">
  <main class="min-h-screen flex items-center justify-center px-4 py-10">
    
    <!-- CREATE MODE -->
    <div class="neon-frame w-full max-w-xl" id="createFrame">
      <div id="createMode" class="glass-card p-8 md:p-10">
        <!-- Header with Orange Accent -->
        <div class="flex items-center justify-center gap-3 mb-2">
          <div class="h-10 w-10 rounded-2xl bg-white/10 border border-white/10 flex items-center justify-center text-2xl">
            ðŸ’Ž
          </div>
          <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">Hash<span class="text-orange-400">Toll</span> Pay</h1>
        </div>
        <p class="text-center text-white/70 mb-8">Create a payment link in seconds</p>

        <!-- Connected Wallet Info -->
        <div id="walletInfo" class="hidden mb-5 rounded-2xl border border-white/10 bg-white/5 p-4">
          <div class="text-xs text-white/60 mb-1 uppercase tracking-wide">Connected</div>
          <div id="connectedAddress" class="text-sm font-mono text-white/80"></div>
        </div>

        <!-- Form -->
        <div class="space-y-5">
          <div>
            <label class="block text-sm font-semibold text-white/80 mb-2">Amount (HBAR)</label>
            <input
              id="amount"
              type="number"
              inputmode="decimal"
              placeholder="50"
              min="0.01"
              step="0.01"
              class="field w-full rounded-2xl px-5 py-4 text-center text-2xl md:text-3xl font-bold placeholder-white/30"
            />
          </div>

          <button
            id="connectBtn"
            class="btn-primary w-full rounded-2xl py-4 text-lg font-semibold transition"
          >
            Connect Wallet
          </button>

          <button
            id="generateBtn"
            disabled
            class="btn-ghost w-full rounded-2xl py-4 text-lg font-semibold transition"
          >
            Generate Payment Link
          </button>

          <!-- Result -->
          <div id="result" class="hidden mt-6 space-y-4">
            <div class="rounded-2xl border border-white/10 bg-white/5 p-5">
              <div class="text-sm font-semibold text-white/70 mb-3">Your Payment Link</div>
              <div class="flex gap-2">
                <input
                  id="paymentLink"
                  readonly
                  class="field flex-1 rounded-xl px-4 py-3 text-xs font-mono"
                  value=""
                />
                <button
                  id="copyBtn"
                  class="btn-ghost rounded-xl px-5 py-3 text-sm font-semibold whitespace-nowrap"
                >
                  ðŸ“‹ Copy
                </button>
              </div>
            </div>

            <!-- QR Code -->
            <div class="qr-wrapper flex justify-center" id="qrCode"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- PAY MODE -->
    <div class="neon-frame w-full max-w-xl hidden" id="payFrame">
      <div id="payMode" class="glass-card p-8 md:p-10">
        <div class="flex items-center justify-center gap-3 mb-2">
          <div class="h-10 w-10 rounded-2xl bg-white/10 border border-white/10 flex items-center justify-center text-2xl">
            ðŸ’Ž
          </div>
          <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">Payment Request</h1>
        </div>
        <p class="text-center text-white/70 mb-8">Complete this payment with HashPack</p>

        <!-- Payment Details -->
        <div class="rounded-2xl border border-white/10 bg-white/5 p-6 mb-6 space-y-4">
          <div class="flex justify-between items-center">
            <span class="text-sm text-white/60 uppercase tracking-wide">Amount</span>
            <span id="payAmount" class="text-4xl font-bold text-white"></span>
          </div>
          <div class="flex justify-between items-start border-t border-white/10 pt-4">
            <span class="text-sm text-white/60 uppercase tracking-wide">To</span>
            <span id="payTo" class="text-xs font-mono text-white/80 text-right max-w-[200px] break-all"></span>
          </div>
        </div>

        <button
          id="payBtn"
          class="btn-primary w-full rounded-2xl py-4 text-lg font-semibold transition"
        >
          Pay with HashPack
        </button>

        <!-- Success State -->
        <div id="txResult" class="hidden text-center mt-8">
          <div class="text-6xl mb-4">âœ…</div>
          <h3 class="text-2xl font-bold text-white mb-2">Payment Successful!</h3>
          <div id="txId" class="text-xs text-white/50 font-mono"></div>
        </div>
      </div>
    </div>

  </main>

  <!-- QR Code Library -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

  <script>
    // Parse URL to detect payment mode
    const urlParams = new URLSearchParams(window.location.search);
    const paymentAmount = urlParams.get('amount');
    const recipientAddress = urlParams.get('to');

    // MODE DETECTION
    if (paymentAmount && recipientAddress) {
      // PAY MODE
      document.getElementById('createFrame').classList.add('hidden');
      document.getElementById('payFrame').classList.remove('hidden');
      document.getElementById('payAmount').textContent = `${paymentAmount} â„`;
      document.getElementById('payTo').textContent = recipientAddress;

      document.getElementById('payBtn').addEventListener('click', async () => {
        try {
          // Payment logic coming next
          alert('Payment logic coming next!');
        } catch (error) {
          console.error(error);
          alert('Payment failed: ' + error.message);
        }
      });

    } else {
      // CREATE MODE
      let connectedAccountId = null;

      // Connect Wallet
      document.getElementById('connectBtn').addEventListener('click', async () => {
        try {
          // Simulate connection (we'll add HashConnect next)
          connectedAccountId = '0.0.1234567';

          document.getElementById('walletInfo').classList.remove('hidden');
          document.getElementById('connectedAddress').textContent = connectedAccountId;
          document.getElementById('connectBtn').textContent = 'âœ“ Wallet Connected';
          document.getElementById('connectBtn').disabled = true;
          document.getElementById('generateBtn').disabled = false;
        } catch (error) {
          alert('Connection failed: ' + error.message);
        }
      });

      // Generate Link
      document.getElementById('generateBtn').addEventListener('click', async () => {
        const amount = document.getElementById('amount').value;

        if (!amount || amount <= 0) {
          alert('Please enter a valid amount');
          return;
        }

        // Generate payment link
        const baseUrl = window.location.origin + window.location.pathname;
        const paymentUrl = `${baseUrl}?to=${connectedAccountId}&amount=${amount}`;

        // Show result
        document.getElementById('paymentLink').value = paymentUrl;
        document.getElementById('result').classList.remove('hidden');

        // Generate QR code
        const qrContainer = document.getElementById('qrCode');
        qrContainer.innerHTML = '';
        QRCode.toCanvas(paymentUrl, {
          width: 240,
          margin: 2,
          color: {
            dark: '#1a1a3e',
            light: '#ffffff'
          }
        }, (err, canvas) => {
          if (err) console.error(err);
          qrContainer.appendChild(canvas);
        });
      });

      // Copy link
      document.getElementById('copyBtn').addEventListener('click', async () => {
        const link = document.getElementById('paymentLink').value;
        try {
          await navigator.clipboard.writeText(link);
          document.getElementById('copyBtn').textContent = 'âœ“ Copied!';
          setTimeout(() => {
            document.getElementById('copyBtn').textContent = 'ðŸ“‹ Copy';
          }, 2000);
        } catch (e) {
          alert('Copy failed');
        }
      });
    }
  </script>
</body>
</html>
